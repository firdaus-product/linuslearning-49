<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kemahiran Pemulihan: Meneroka Nombor 1â€“1000</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    .activity-card { min-height: 400px; }
    .number-card { transition: all .3s ease; cursor: pointer; }
    .number-card:hover { transform: scale(1.05); }
    .dragging { opacity: .5; transform: rotate(5deg); }

    /* Drop zone */
    .drop-zone {
      border: 2px dashed #cbd5e1;
      transition: all .3s ease;
      min-width: 60px;
      min-height: 60px;
      display: inline-block;
      vertical-align: middle;
    }
    .drop-zone.drag-over { border-color: #3b82f6; background-color: #eff6ff; }

    /* Salah */
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.5s ease; }

    /* Zon sudah diisi */
    .drop-zone-filled {
      border-style: solid;
      border-color: #4ade80;
      background-color: #f0fdf4;
    }

    /* Aktiviti 1 - Petak 1000 */
    .grid-tab {
      padding: 8px 16px; border-radius: 8px; font-weight: 600;
      background-color: #e0e7ff; color: #4338ca;
    }
    .grid-tab.active { background-color: #4f46e5; color: white; }
    .grid-cell {
      width: calc(10% - 8px); height: 40px; margin: 4px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; border: 1px solid #d1d5db; border-radius: 6px;
      cursor: pointer; transition: all .2s ease;
    }
    .grid-cell:hover { background-color: #fef3c7; border-color: #fcd34d; }
    .grid-cell.selected { background-color: #fcd34d; border-color: #f59e0b; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-full">

  <div class="bg-yellow-100 border-b-4 border-yellow-300 p-4 shadow-sm sticky top-0 z-10">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">ğŸ“š</span>
        <span id="info-text" class="text-lg font-semibold text-gray-800">
          Pilih aktiviti untuk mula belajar nombor!
        </span>
      </div>
      <button id="speak-btn"
              class="bg-yellow-300 hover:bg-yellow-400 text-yellow-800 font-bold py-2 px-4 rounded-full text-xl transition-colors duration-200"
              onclick="speakInfo()">
        ğŸ”Š
      </button>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 activity-card flex items-center justify-center">
      <div id="activity-content" class="text-center w-full">
        <div class="py-16">
          <div class="text-6xl mb-4">ğŸ”¢</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Kemahiran Pemulihan: Meneroka Nombor 1â€“1000
          </h2>
          <p class="text-xl text-gray-600 mb-8">
            Pilih aktiviti di bawah untuk meneroka sebutan dan nilai nombor.
          </p>
          <div class="text-4xl">ğŸ‘‡</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Pilih Aktiviti</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
        <button onclick="loadActivity(1)"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ğŸ¯ Petak 1000
        </button>
        <button onclick="loadActivity(2)"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ğŸ—ï¸ Pembina Nombor
        </button>
        <button onclick="loadActivity(3)"
                class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          âœï¸ Penterjemah Nombor
        </button>
        <button onclick="loadActivity(4)"
                class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ğŸ² Penjana Rawak
        </button>
        <button onclick="loadActivity(5)"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ğŸ§© Suai Padan
        </button>
      </div>

      <div class="flex justify-center gap-4">
        <button onclick="clearActivity()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          ğŸ§¹ Bersih
        </button>
        <button onclick="nextActivity()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          â¡ï¸ Seterusnya
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti untuk mula belajar nombor!";
    let draggedElement = null;
    let ttsTimeout = null; 

    /* ====== TTS ====== */
    function speak(text) {
      if (!ttsEnabled) return;
      if (!('speechSynthesis' in window)) return;
      
      window.speechSynthesis.cancel(); 

      if (ttsTimeout) {
        clearTimeout(ttsTimeout);
      }

      ttsTimeout = setTimeout(() => {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ms-MY';
        u.rate = 0.9; u.pitch = 1.05;
        const voices = window.speechSynthesis.getVoices();
        const ms = voices.find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms'));
        if (ms) u.voice = ms;

        u.onend = () => { ttsTimeout = null; };
        u.onerror = () => { ttsTimeout = null; };

        window.speechSynthesis.speak(u);
        ttsTimeout = null; 
      }, 100); 
    }

    function setInfo(text) { currentInfo = text; document.getElementById('info-text').textContent = text; }
    function speakInfo() {
      if (!ttsEnabled) {
        ttsEnabled = true;
        const btn = document.getElementById('speak-btn');
        btn.classList.add('bg-green-300', 'hover:bg-green-400');
        btn.classList.remove('bg-yellow-300', 'hover:bg-yellow-400');
      }
      speak(currentInfo);
    }

    /* ====== DnD helpers ====== */
    function dragStart(e) { draggedElement = e.target; e.target.classList.add('dragging'); }
    function dragEnd(e) { e.target.classList.remove('dragging'); document.querySelectorAll('.drop-zone').forEach(z=>z.classList.remove('drag-over')); }
    function allowDrop(e) { e.preventDefault(); if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.add('drag-over'); }
    function dragLeave(e) { if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.remove('drag-over'); }

    /* ====== HELPER: Number to Words (1-1000) ====== */
    function numToWords(n) {
      n = parseInt(n);
      if (isNaN(n) || n < 0) return "";
      if (n === 0) return "kosong";
      if (n === 1000) return "seribu";

      const ONES = ["", "satu", "dua", "tiga", "empat", "lima", "enam", "tujuh", "lapan", "sembilan"];
      const TEENS = ["sepuluh", "sebelas", "dua belas", "tiga belas", "empat belas", "lima belas", "enam belas", "tujuh belas", "lapan belas", "sembilan belas"];
      const TENS = ["", "", "dua puluh", "tiga puluh", "empat puluh", "lima puluh", "enam puluh", "tujuh puluh", "lapan puluh", "sembilan puluh"];

      let words = "";
      
      const ratus = Math.floor(n / 100);
      if (ratus > 0) {
        words += (ratus === 1 ? "seratus" : ONES[ratus] + " ratus");
      }

      const remainder = n % 100;
      if (remainder > 0) {
        if (ratus > 0) words += " ";
        if (remainder < 10) {
          words += ONES[remainder];
        } else if (remainder < 20) {
          words += TEENS[remainder - 10];
        } else {
          words += TENS[Math.floor(remainder / 10)];
          const sa = remainder % 10;
          if (sa > 0) {
            words += " " + ONES[sa];
          }
        }
      }
      return words;
    }

    /* ====== Router ====== */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      if (n === 1) return loadNumberGridActivity(content);
      if (n === 2) return loadNumberBuilderActivity(content);
      if (n === 3) return loadTranslatorActivity(content);
      if (n === 4) return loadRandomNumberActivity(content);
      if (n === 5) return loadMatchingActivity(content);
    }

    /* ====== Aktiviti 1: Petak 1000 ====== */
    function loadNumberGridActivity(content) {
      setInfo("Pilih julat nombor, kemudian klik mana-mana nombor untuk mendengar sebutannya.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-blue-600 mb-4">ğŸ¯ Petak 1000</h3>
        <div id="grid-tabs" class="flex flex-wrap justify-center gap-2 mb-4">
          ${[0, 100, 200, 300, 400, 500, 600, 700, 800, 900].map(start => `
            <button class="grid-tab" onclick="generateGrid(${start + 1}, ${start + 100})">
              ${start + 1}â€“${start + 100}
            </button>
          `).join('')}
        </div>
        <div id="number-grid" class="flex flex-wrap justify-center bg-white p-2 rounded-lg shadow-inner">
          <p class="text-gray-500 p-8">Pilih julat di atas untuk mula.</p>
        </div>
      `;
      // Auto-load grid pertama
      generateGrid(1, 100);
      content.querySelector('.grid-tab').classList.add('active');
    }
    function generateGrid(start, end) {
      // Kemas kini tab aktif
      document.querySelectorAll('#grid-tabs .grid-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.textContent.startsWith(start + 'â€“')) {
          tab.classList.add('active');
        }
      });
      // Jana grid
      const grid = document.getElementById('number-grid');
      grid.innerHTML = '';
      for (let i = start; i <= end; i++) {
        const cell = document.createElement('div');
        cell.className = 'grid-cell';
        cell.textContent = i;
        cell.onclick = () => clickGridNumber(i, cell);
        grid.appendChild(cell);
      }
      setInfo(`Meneroka nombor ${start} hingga ${end}. Klik satu nombor.`);
    }

    function clickGridNumber(num, el) {
      document.querySelectorAll('#number-grid .grid-cell').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
      const words = numToWords(num);
      const infoMsg = `${num}: ${words}.`; 
      const speakMsg = `Sebutannya ${words}.`; 
      setInfo(infoMsg);
      speak(speakMsg);
    }

    /* ====== Aktiviti 2: Pembina Nombor ====== */
    function loadNumberBuilderActivity(content) {
      setInfo("Gunakan menu untuk membina nombor dan lihat hasilnya.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-green-600 mb-6">ğŸ—ï¸ Pembina Nombor (Nilai Tempat)</h3>
        <div class="flex flex-wrap justify-center gap-4 mb-6">
          <div classs="flex-1">
            <label for="select-ratus" class="text-lg font-semibold text-gray-700">Ratus</label>
            <select id="select-ratus" onchange="updateNumberBuilder()" class="text-2xl p-3 border-2 border-gray-300 rounded-lg w-full">
              ${[...Array(10).keys()].map(i => `<option value="${i}">${i}</option>`).join('')}
            </select>
          </div>
          <div classs="flex-1">
            <label for="select-puluh" class="text-lg font-semibold text-gray-700">Puluh</label>
            <select id="select-puluh" onchange="updateNumberBuilder()" class="text-2xl p-3 border-2 border-gray-300 rounded-lg w-full">
              ${[...Array(10).keys()].map(i => `<option value="${i}">${i}</option>`).join('')}
            </select>
          </div>
          <div classs="flex-1">
            <label for="select-sa" class="text-lg font-semibold text-gray-700">Sa</label>
            <select id="select-sa" onchange="updateNumberBuilder()" class="text-2xl p-3 border-2 border-gray-300 rounded-lg w-full">
              ${[...Array(10).keys()].map(i => `<option value="${i}">${i}</option>`).join('')}
            </select>
          </div>
        </div>
        <div id="builder-result" class="bg-green-50 border-2 border-green-200 p-6 rounded-xl text-center">
          <div class="text-5xl font-bold text-green-800 mb-2">0</div>
          <div class="text-xl font-semibold text-green-700">kosong</div>
          <button class="mt-4 bg-green-200 text-green-800 px-4 py-2 rounded-full font-semibold" onclick="speak('Sebutannya kosong.')">ğŸ”Š Sebut</button>
        </div>
      `;
      updateNumberBuilder();
    }
    function updateNumberBuilder() {
      const r = parseInt(document.getElementById('select-ratus').value) || 0;
      const p = parseInt(document.getElementById('select-puluh').value) || 0;
      const s = parseInt(document.getElementById('select-sa').value) || 0;
      const total = r * 100 + p * 10 + s;
      const words = numToWords(total);
      
      const resultEl = document.getElementById('builder-result');
      resultEl.innerHTML = `
        <div id="builder-result-num" class="text-5xl font-bold text-green-800 mb-2">${total}</div>
        <div class="text-xl font-semibold text-green-700">${words}</div>
        <button class="mt-4 bg-green-200 text-green-800 px-4 py-2 rounded-full font-semibold" onclick="speak('Sebutannya ${words}.')">ğŸ”Š Sebut</button>
      `;
      setInfo(`Binaan nombor: ${total}. Sebutan: ${words}.`);
    }

    /* ====== Aktiviti 3: Penterjemah Nombor ====== */
    function loadTranslatorActivity(content) {
      setInfo("Taip nombor dalam kotak untuk melihat sebutannya.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-purple-600 mb-6">âœï¸ Penterjemah Angka ke Perkataan</h3>
        <div class="w-full max-w-md mx-auto">
          <label for="input-angka" class="text-lg font-semibold text-gray-700">Taip Angka (0-1000):</label>
          <input type="number" id="input-angka" min="0" max="1000" oninput="updateTranslator()" 
                 class="w-full text-4xl p-4 border-2 border-purple-300 rounded-lg text-center font-bold" 
                 placeholder="cth: 452">
        </div>
        <div id="translator-result" class="mt-6 bg-purple-50 border-2 border-purple-200 p-6 rounded-xl text-center min-h-32">
          <p class="text-2xl font-semibold text-purple-700">...</p>
        </div>
      `;
    }
    function updateTranslator() {
      const input = document.getElementById('input-angka');
      let num = parseInt(input.value);
      if (isNaN(num)) {
        document.getElementById('translator-result').innerHTML = `<p class="text-2xl font-semibold text-purple-700">...</p>`;
        return;
      }
      if (num > 1000) { num = 1000; input.value = 1000; }
      if (num < 0) { num = 0; input.value = 0; }
      
      const words = numToWords(num);
      document.getElementById('translator-result').innerHTML = `
        <p class="text-3xl font-bold text-purple-800">${words}</p>
        <button class="mt-4 bg-purple-200 text-purple-800 px-4 py-2 rounded-full font-semibold" onclick="speak('Sebutannya ${words}.')">ğŸ”Š Sebut</button>
      `;
      setInfo(`Angka ${num} disebut ${words}.`);
    }

    /* ====== Aktiviti 4: Penjana Rawak ====== */
    function loadRandomNumberActivity(content) {
      setInfo("Tekan butang untuk menjana nombor rawak (1-1000).");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-orange-600 mb-6">ğŸ² Penjana Nombor Rawak</h3>
        <div id="random-result" class="bg-orange-50 border-2 border-orange-200 p-10 rounded-xl text-center min-h-48 flex flex-col justify-center items-center">
          <p class="text-2xl font-semibold text-orange-700">Tekan butang di bawah.</p>
        </div>
        <button class="mt-6 bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-lg text-xl" 
                onclick="generateRandomNumber()">
          Jana Nombor Baru!
        </button>
      `;
    }

    function generateRandomNumber() {
      const num = Math.floor(Math.random() * 1000) + 1; // 1 hingga 1000
      const words = numToWords(num);
      document.getElementById('random-result').innerHTML = `
        <div class="text-7xl font-bold text-orange-800 mb-2">${num}</div>
        <div class="text-2xl font-semibold text-orange-700">${words}</div>
        <button class="mt-4 bg-orange-200 text-orange-800 px-4 py-2 rounded-full font-semibold" onclick="speak('Sebutannya ${words}.')">ğŸ”Š Sebut</button>
      `;
      const infoMsg = `Nombor rawak: ${num}. ${words}.`;
      const speakMsg = `Sebutannya ${words}.`;
      setInfo(infoMsg);
      speak(speakMsg); 
    }

    /* ====== Aktiviti 5: Suai Padan ====== */
    function loadMatchingActivity(content) {
      setInfo("Seret kad angka (kiri) ke kad perkataan (kanan) yang sepadan.");
      const pairs = [
        { num: 125, words: "seratus dua puluh lima" },
        { num: 340, words: "tiga ratus empat puluh" },
        { num: 802, words: "lapan ratus dua" },
        { num: 555, words: "lima ratus lima puluh lima" },
        { num: 90,  words: "sembilan puluh" },
      ];
      const shuffled = [...pairs].sort(() => Math.random() - 0.5);

      content.innerHTML = `
        <h3 class="text-2xl font-bold text-red-600 mb-6">ğŸ§© Suai Padan (Angka & Perkataan)</h3>
        <div class="flex flex-col md:flex-row gap-6">
          <div class="flex-1">
            <h4 class="text-lg font-semibold mb-3 text-center">Kad Angka (Seret)</h4>
            <div id="number-choices" class="flex flex-col items-center gap-4">
              ${shuffled.map(pair => `
                <div class="number-card bg-red-100 border-2 border-red-300 rounded-lg p-4 text-2xl font-bold text-red-800 cursor-move w-48 text-center"
                     draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="${pair.num}">
                  ${pair.num}
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="w-full md:w-px bg-gray-300 h-px md:h-auto"></div>

          <div class="flex-1">
            <h4 class="text-lg font-semibold mb-3 text-center">Kad Perkataan (Letak di sini)</h4>
            <div id="word-targets" class="flex flex-col items-center gap-4">
              ${pairs.map(pair => `
                <div class="drop-zone rounded-lg p-4 w-full md:w-72 text-lg font-semibold text-gray-700 text-center"
                     ondrop="dropOnMatch(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-correct="${pair.num}">
                  ${pair.words}
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
    
    // ##### KEMAS KINI DI SINI #####
    function dropOnMatch(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('drag-over');
      if (!draggedElement) return;

      const draggedNumber = draggedElement.dataset.number;
      const correctNumber = e.currentTarget.dataset.correct;

      if (draggedNumber === correctNumber) {
        e.currentTarget.innerHTML = `âœ… ${draggedNumber} - ${e.currentTarget.textContent.trim()}`;
        e.currentTarget.classList.add('drop-zone-filled');
        e.currentTarget.classList.remove('drop-zone');
        e.currentTarget.removeAttribute('ondrop');
        draggedElement.remove();
        draggedElement = null;
        
        // Perubahan di sini:
        const infoMsg = `Betul! ${draggedNumber} ialah ${numToWords(draggedNumber)}.`;
        const speakMsg = `Betul!`; // Audio dipendekkan
        
        setInfo(infoMsg);  // Papar mesej penuh
        speak(speakMsg); // Sebut mesej pendek

        if (document.querySelectorAll('#word-targets .drop-zone').length === 0) {
          setInfo("Syabas! Semua berjaya dipadankan!");
          speak("Syabas! Semua berjaya dipadankan!");
        }
      } else {
        setInfo(`Bukan di situ. Cuba lagi.`);
        speak(`Bukan di situ. Cuba lagi.`);
        e.currentTarget.classList.add('shake');
        setTimeout(() => e.currentTarget.classList.remove('shake'), 500);
      }
    }


    /* ====== Kawalan Umum ====== */
    function clearActivity() {
      currentActivity = 0;
      document.getElementById('activity-content').innerHTML = `
        <div class="text-center py-16">
          <div class="text-6xl mb-4">ğŸ”¢</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Kemahiran Pemulihan: Meneroka Nombor 1â€“1000</h2>
          <p class="text-xl text-gray-600 mb-8">Pilih aktiviti di bawah untuk meneroka sebutan dan nilai nombor.</p>
          <div class="text-4xl">ğŸ‘‡</div>
        </div>
      `;
      setInfo("Pilih aktiviti untuk mula belajar nombor!");
    }
    function nextActivity() {
      if (currentActivity === 0) return loadActivity(1);
      if (currentActivity < 5) return loadActivity(currentActivity + 1);
      return loadActivity(1);
    }

    // Kekalkan TTS resume pada sesetengah pelayar
    if ('speechSynthesis' in window) {
      setInterval(() => { if (window.speechSynthesis.paused) window.speechSynthesis.resume(); }, 1000);
    }
  </script>
</body>
</html>
